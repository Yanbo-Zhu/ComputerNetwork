
# 1 ApplicationLayer

## 1.1 Domain Name System (dig comamnd)


### 1.1.1 two DNS recursive resolvers

public resolver: 
OpenDNS 208.67.222.222 or Quad9 Public DNS 9.9.9.9

public DNS resolvers: https://public-dns.info/


本机的  local network provider
You can find out your recursive resolver by looking into the file /etc/resolv.conf on most UNIX-based operating systems. On Windows, run ipconfig /all in a terminal


ipconfig /all
```
Wireless LAN adapter Wi-Fi:

   Connection-specific DNS Suffix  . : localdomain
   Description . . . . . . . . . . . : Intel(R) Wi-Fi 6E AX211 160MHz
   Physical Address. . . . . . . . . : 30-05-05-9D-99-82
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   IPv6 Address. . . . . . . . . . . : 2a01:c22:adda:8f00:9e6:3506:271c:9ccc(Preferred)
   Temporary IPv6 Address. . . . . . : 2a01:c22:adda:8f00:dcc7:cde5:6fa7:a8c7(Preferred)
   Link-local IPv6 Address . . . . . : fe80::e3d7:a8ae:291d:8b6d%2(Preferred)
   IPv4 Address. . . . . . . . . . . : 192.168.1.30(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Lease Obtained. . . . . . . . . . : Tuesday, 29 October, 2024 16:08:50
   Lease Expires . . . . . . . . . . : Wednesday, 6 November, 2024 08:50:41
   Default Gateway . . . . . . . . . : fe80::1%2
                                       192.168.1.1
   DHCP Server . . . . . . . . . . . : 192.168.1.1
   DHCPv6 IAID . . . . . . . . . . . : 36701445
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-2C-1B-96-22-AC-91-A1-3F-39-D1
   DNS Servers . . . . . . . . . . . : fe80::1%2
                                       192.168.1.1   # 这个是我要找到 local DNS recursive resolvers/server
   NetBIOS over Tcpip. . . . . . . . : Enabled
   Connection-specific DNS Suffix Search List :
                                       localdomain
```


wsl 中
cat /etc/resolv.conf
```
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 192.168.1.1   # 这个是我要找到 local DNS recursive resolvers/server
nameserver fe80::1
search localdomain
```


### 1.1.2 

```
dig @208.67.222.222 www.wikipedia.org A

; <<>> DiG 9.18.18-0ubuntu0.22.04.1-Ubuntu <<>> @208.67.222.222 www.wikipedia.org A
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 428
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1410
;; QUESTION SECTION:
;www.wikipedia.org.             IN      A

;; ANSWER SECTION:
www.wikipedia.org.      21715   IN      CNAME   dyna.wikimedia.org.
dyna.wikimedia.org.     300     IN      A       185.15.59.224

;; Query time: 121 msec
;; SERVER: 208.67.222.222#53(208.67.222.222) (UDP)
;; WHEN: Wed Oct 30 09:04:02 CET 2024
;; MSG SIZE  rcvd: 91





yzh@BNB23350:~$ dig @208.67.222.222 www.wikipedia.org AAAA

; <<>> DiG 9.18.18-0ubuntu0.22.04.1-Ubuntu <<>> @208.67.222.222 www.wikipedia.org AAAA
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 26909
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1410
;; QUESTION SECTION:
;www.wikipedia.org.             IN      AAAA

;; ANSWER SECTION:
www.wikipedia.org.      44726   IN      CNAME   dyna.wikimedia.org.
dyna.wikimedia.org.     300     IN      AAAA    2a02:ec80:300:ed1a::1

;; Query time: 121 msec
;; SERVER: 208.67.222.222#53(208.67.222.222) (UDP)
;; WHEN: Wed Oct 30 09:04:38 CET 2024
;; MSG SIZE  rcvd: 103

```




```
yzh@BNB23350:~$ dig @192.168.1.1 www.wikipedia.org AAAA

; <<>> DiG 9.18.18-0ubuntu0.22.04.1-Ubuntu <<>> @192.168.1.1 www.wikipedia.org AAAA
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 14310
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;www.wikipedia.org.             IN      AAAA

;; ANSWER SECTION:
www.wikipedia.org.      19074   IN      CNAME   dyna.wikimedia.org.
dyna.wikimedia.org.     300     IN      AAAA    2a02:ec80:300:ed1a::1

;; Query time: 22 msec
;; SERVER: 192.168.1.1#53(192.168.1.1) (UDP)
;; WHEN: Wed Oct 30 09:13:38 CET 2024
;; MSG SIZE  rcvd: 103




yzh@BNB23350:~$ dig @192.168.1.1 www.wikipedia.org A

; <<>> DiG 9.18.18-0ubuntu0.22.04.1-Ubuntu <<>> @192.168.1.1 www.wikipedia.org A
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 17149
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;www.wikipedia.org.             IN      A

;; ANSWER SECTION:
www.wikipedia.org.      19068   IN      CNAME   dyna.wikimedia.org.
dyna.wikimedia.org.     140     IN      A       185.15.59.224

;; Query time: 22 msec
;; SERVER: 192.168.1.1#53(192.168.1.1) (UDP)
;; WHEN: Wed Oct 30 09

```


### 1.1.3 nslookup 

Rechnernetz课程 theorie2 

Die Zuordnung von Domainnamen zu IP-Adressen erfolgt im Internet mit Hilfe des Domain Name Systems (DNS). Überprüfen Sie mittels des Kommandozeilen-Tools dig (Linux/ OS X) bzw. nslookup (Windows), welche DNS-Server für die Domain tu.berlin sowie deren Subdomains zuständig sind und welche TTL diese Einträge haben.

```
 ⚡ 🦄  nslookup -type=NS tu.berlin
Server:  o2.box
Address:  fe80::1

DNS request timed out.
    timeout was 2 seconds.
Non-authoritative answer:
tu.berlin       nameserver = dns-2.dfn.de
tu.berlin       nameserver = dns-3.dfn.de
tu.berlin       nameserver = ns.tu-berlin.de

dns-3.dfn.de    internet address = 193.174.75.58
dns-3.dfn.de    AAAA IPv6 address = 2001:638:d:b103::1
ns.tu-berlin.de internet address = 130.149.7.7
ns.tu-berlin.de AAAA IPv6 address = 2001:638:809:7::7
dns-2.dfn.de    internet address = 193.174.75.54
dns-2.dfn.de    AAAA IPv6 address = 2001:638:d:b102::1
```


https://www.tu.berlin/campusmanagement/angebot/netzwerk-an-der-tu/ip-und-dns-verwaltung

- primärer Nameserver 130.149.7.7 (ns.tu-berlin.de)
- externer, sekundärer Nameserver: 192.129.31.50 (res-1.dfn.de)





query each authoritative server with:
`nslookup tu.berlin <nameserver>`
```
nslookup tu.berlin ns.tu-berlin.de
Server:  ns.tu-berlin.de
Address:  130.149.7.7

Name:    tu.berlin
Address:  141.23.73.70
```


## 1.2 HTTP (telnet command)


### 1.2.1 a task 

> Telnet into a Web server and send a valid HTTP/ 1.1 request message!4 Include in the request message the **If-modified-since**: header line to force a response message with the 304 Not Modified status code. Include a full log of the telnet session in your solution.

If-Modified-Since的理论解释: 
https://www.youtube.com/watch?v=0QHmHR55_Lo&t=30s
The **`If-Modified-Since`** request HTTP header makes the request conditional: the server sends back the requested resource, with a [`200`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200) status, only if it has been last modified after the given date. If the resource has not been modified since, the response is a [`304`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/304) without any body; the [`Last-Modified`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Last-Modified) response header of a previous request contains the date of last modification. Unlike [`If-Unmodified-Since`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Unmodified-Since), `If-Modified-Since` can only be used with a [`GET`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET) or [`HEAD`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/HEAD).

==A `304 Not Modified` response indicates that the resource has not changed since the last request, meaning the client can use its ***cached version***. A `200 OK` response indicates that the request was successful and the server is returning the requested resource.==

When used in combination with [`If-None-Match`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-None-Match), it is ignored, unless the server doesn't support `If-None-Match`.
The most common use case is to update a cached entity that has no associated [`ETag`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag).


实验方式 

```
# 先建立一个 connection 
telnet example.com 80

# Constructing the HTTP Request: After you connect, type the following HTTP request (replace the date with a date that you know the resource hasn't changed since):
# /your-resource 需要替换成 index.html 或者其他的 , 但是不能为空, 使用 GET HTTP/1.1 的会返回 200 code 

发
GET /index.html HTTP/1.1    
Host: example.com
If-Modified-Since: Wed, 21 Oct 2024 07:28:00 GMT
Connection: close

返回为 
HTTP/1.1 304 Not Modified
Accept-Ranges: bytes
Age: 486427
Cache-Control: max-age=604800
Date: Wed, 30 Oct 2024 09:30:55 GMT
Etag: "3147526947+gzip"
Expires: Wed, 06 Nov 2024 09:30:55 GMT
Last-Modified: Thu, 17 Oct 2019 07:18:26 GMT
Server: ECAcc (mid/871B)
Vary: Accept-Encoding
X-Cache: HIT
Connection: close
```

```
发
GET HTTP/1.1    
Host: example.com
If-Modified-Since: Wed, 21 Oct 2024 07:28:00 GMT
Connection: close

返回为 
HTTP/1.1 200 OK
Age: 134813
Cache-Control: max-age=604800
Content-Type: text/html; charset=UTF-8
Date: Wed, 30 Oct 2024 09:25:57 GMT
Etag: "3147526947+gzip+ident"
Expires: Wed, 06 Nov 2024 09:25:57 GMT
Last-Modified: Thu, 17 Oct 2019 07:18:26 GMT
Server: ECAcc (mid/8716)
Vary: Accept-Encoding
X-Cache: HIT
Content-Length: 1256
Connection: close

<!doctype html>
<html>
<head>
    <title>Example Domain</title>

    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type="text/css">
    body {
        background-color: #f0f0f2;
        margin: 0;
        padding: 0;
        font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;

    }
    div {
        width: 600px;
        margin: 5em auto;
        padding: 2em;
        background-color: #fdfdff;
        border-radius: 0.5em;
        box-shadow: 2px 3px 7px 2px rgba(0,0,0,0.02);
    }
    a:link, a:visited {
        color: #38488f;
        text-decoration: none;
    }
    @media (max-width: 700px) {
        div {
            margin: 0 auto;
            width: auto;
        }
    }
    </style>
</head>

<body>
<div>
    <h1>Example Domain</h1>
    <p>This domain is for use in illustrative examples in documents. You may use this
    domain in literature without prior coordination or asking for permission.</p>
    <p><a href="https://www.iana.org/domains/example">More information...</a></p>
</div>
</body>
</html>

```


### 1.2.2 b task 

Telnet into the same or a different Web server and send a valid HTTP/ 1.1 request message! Construct your request in a way to force a response message with the **404 Not Found** status code. Include a log of the telnet session in your solution. Do not include the body of the response!

```
yzh@BNB23350:~$ telnet example.com 80
Trying 2606:2800:21f:cb07:6820:80da:af6b:8b2c...
Trying 93.184.215.14...
Connected to example.com.
Escape character is '^]'.

GET /indexyzh.html HTTP/1.1    # 这里给出的indexyzh.html 是不存在的
Host: example.com
If-Modified-Since: Wed, 21 Oct 2024 07:28:00 GMT
Connection: keep-alive


reponse 为 
HTTP/1.1 404 Not Found
Accept-Ranges: bytes
Age: 361058
Cache-Control: max-age=604800
Content-Type: text/html
Date: Wed, 30 Oct 2024 09:31:50 GMT
Etag: "1088432560"
Expires: Wed, 06 Nov 2024 09:31:50 GMT
Last-Modified: Sat, 12 Oct 2024 03:26:51 GMT
Server: ECAcc (mid/875F)
Vary: Accept-Encoding
X-Cache: 404-HIT
Content-Length: 1256
```



### 1.2.3 c task 

> Assume that a Web server at http://example.org hosts a file called index.html, which is a Web page with two pictures: http://images.example.org/logo.png and http://images.example.org/hello.jpg. The pictures are hosted on another server than the index page. One day, the admin accidentally deletes hello.jpg.
> Now, a Web client loads this page, using persistent HTTP/1.1. What HTTP messages does the client send and receive? Provide at least the methods, necessary headers, and status codes.


persistent HTTP
```
GET /index.html HTTP/1.1
Host: example.org
Connection: keep-alive   # 就是设置成这样 
```


# 2 connect to remote server 

## 2.1 iperf3 (like ping )

Kommando `iperf3 -c [HOSTNAME]` um mit dem iperf3 Programm den Durchsatz von ihrem Rechner zu dem oben gewählten Server über Streaming-Sockets zu messen.

**Iperf3** is a widely used open-source tool for network performance measurement and tuning. It allows users to measure the bandwidth, loss, jitter, and other aspects of TCP and UDP connections between two devices over a network.

Key Features of Iperf3:
1. **Client-Server Model**: One device runs as a server, and another runs as a client to test the connection.
2. **Cross-Platform**: Works on Linux, macOS, and Windows.
3. **Protocol Support**: Tests both **TCP** and **UDP** connections.
4. **Customizable Parameters**: You can adjust options like buffer sizes, bandwidth, duration, etc.
5. **Detailed Metrics**: Provides insights like throughput, packet loss, and jitter for UDP, and retransmissions for TCP.


Common Usage:
1. **Start the Server**: On one machine, start the Iperf3 server: `iperf3 -s`
2. **Run the Client**: On the other machine, run the client, specifying the server's IP address and Test **TCP** (default)::  `iperf3 -c <server-ip>`\
    1. Test **UDP**: `iperf3 -c <server-ip> -u`
3. **Reverse Mode** (server sends data to the client): `iperf3 -c <server-ip> -R`


Example Output:
For a TCP connection, you might see:
```
Connecting to host <server-ip>, port 5201
[  4] local <client-ip> port 50000 connected to <server-ip> port 5201
[ ID] Interval           Transfer     Bandwidth       Retr
[  4]   0.00-1.00   sec  112 MBytes   941 Mbits/sec    0             
[  4]   1.00-2.00   sec  112 MBytes   940 Mbits/sec    0             
...
```




## 2.2 Netcat (nc)

==Das Programm netcat (kurz nc) ist ein einfaches Netzwerkprogramm, das eine Verbindung zu einem entfernten Server aufbaut und die Eingabe von stdin über das Netzwerk an den entfernten Server sendet. ==
Das Programm kann auch als Server fungieren, wobei auf eingehende Verbindungen gewartet wird und alle empfangenen Daten nach stdout geschrieben werden. 
Netcat ist deshalb gut geeignet, um die eigene Implementierung von einfachen Netzwerkprotokollen zu testen. 

Probieren Sie deshalb die folgenden Anwendungsbeispiele aus:
Benutzen Sie das nc Kommandozeilen-Programm und rufen Sie eine Webseite auf der Konsole ab. Beispiel:
```
echo -n -e "GET / HTTP/1.1\r\n\
Host: whatismyip.akamai.com\r\n\
Connection: close\r\n\r\n" | nc whatismyip.akamai.com 80
```